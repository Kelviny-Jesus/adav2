import{a as X,r as w,j as u}from"./components-CloOpq9Q.js";import{K as e,M as h,O as Y,Q as K,R as Q,S as W,U as D,V as P,W as Z,X as ee,Y as te,Z as O,_ as A,$ as ae,a0 as re,a1 as N,a2 as ne,a3 as oe,a4 as se,a5 as C,a6 as ie,a7 as le,a8 as ce}from"./Header-BK_oTWWV.js";import"./index-C3YgEsuc.js";var ue=Object.defineProperty,j=(t,a)=>{for(var n in a)ue(t,n,{get:a[n],enumerable:!0})};function F(t,{contentType:a,dataStreamVersion:n}){const r=new Headers(t??{});return r.has("Content-Type")||r.set("Content-Type",a),r.set("X-Vercel-AI-Data-Stream",n),r}var k="AI_NoObjectGeneratedError",U=`vercel.ai.error.${k}`,pe=Symbol.for(U),B,E=class extends D{constructor({message:t="No object generated.",cause:a,text:n,response:r,usage:o}){super({name:k,message:t,cause:a}),this[B]=!0,this.text=n,this.response=r,this.usage=o}static isInstance(t){return D.hasMarker(t,U)}};B=pe;var q=e.union([e.string(),e.instanceof(Uint8Array),e.instanceof(ArrayBuffer),e.custom(t=>{var a,n;return(n=(a=globalThis.Buffer)==null?void 0:a.isBuffer(t))!=null?n:!1},{message:"Must be a Buffer"})]),T=e.lazy(()=>e.union([e.null(),e.string(),e.number(),e.boolean(),e.record(e.string(),T),e.array(T)])),c=e.record(e.string(),e.record(e.string(),T)),de=e.array(e.union([e.object({type:e.literal("text"),text:e.string()}),e.object({type:e.literal("image"),data:e.string(),mimeType:e.string().optional()})])),z=e.object({type:e.literal("text"),text:e.string(),providerOptions:c.optional(),experimental_providerMetadata:c.optional()}),me=e.object({type:e.literal("image"),image:e.union([q,e.instanceof(URL)]),mimeType:e.string().optional(),providerOptions:c.optional(),experimental_providerMetadata:c.optional()}),fe=e.object({type:e.literal("file"),data:e.union([q,e.instanceof(URL)]),mimeType:e.string(),providerOptions:c.optional(),experimental_providerMetadata:c.optional()}),he=e.object({type:e.literal("tool-call"),toolCallId:e.string(),toolName:e.string(),args:e.unknown(),providerOptions:c.optional(),experimental_providerMetadata:c.optional()}),ge=e.object({type:e.literal("tool-result"),toolCallId:e.string(),toolName:e.string(),result:e.unknown(),content:de.optional(),isError:e.boolean().optional(),providerOptions:c.optional(),experimental_providerMetadata:c.optional()}),Se=e.object({role:e.literal("system"),content:e.string(),providerOptions:c.optional(),experimental_providerMetadata:c.optional()}),ve=e.object({role:e.literal("user"),content:e.union([e.string(),e.array(e.union([z,me,fe]))]),providerOptions:c.optional(),experimental_providerMetadata:c.optional()}),xe=e.object({role:e.literal("assistant"),content:e.union([e.string(),e.array(e.union([z,he]))]),providerOptions:c.optional(),experimental_providerMetadata:c.optional()}),ye=e.object({role:e.literal("tool"),content:e.array(ge),providerOptions:c.optional(),experimental_providerMetadata:c.optional()});e.union([Se,ve,xe,ye]);var we="JSON schema:",Te="You MUST answer with a JSON object that matches the JSON schema above.",je="You MUST answer with JSON.";function be({prompt:t,schema:a,schemaPrefix:n=a!=null?we:void 0,schemaSuffix:r=a!=null?Te:je}){return[t!=null&&t.length>0?t:void 0,t!=null&&t.length>0?"":void 0,n,a!=null?JSON.stringify(a):void 0,r].filter(o=>o!=null).join(`
`)}h({prefix:"aiobj",size:24});h({prefix:"aiobj",size:24});h({prefix:"aitxt",size:24});h({prefix:"msg",size:24});var _e={};j(_e,{object:()=>Ie,text:()=>Re});var Re=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:t}){return t},parsePartial({text:t}){return{partial:t}},parseOutput({text:t}){return t}}),Ie=({schema:t})=>{const a=Y(t);return{type:"object",responseFormat:({model:n})=>({type:"json",schema:n.supportsStructuredOutputs?a.jsonSchema:void 0}),injectIntoSystemPrompt({system:n,model:r}){return r.supportsStructuredOutputs?n:be({prompt:n,schema:a.jsonSchema})},parsePartial({text:n}){const r=W(n);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{const o=r.state;throw new Error(`Unsupported parse state: ${o}`)}}},parseOutput({text:n},r){const o=K({text:n});if(!o.success)throw new E({message:"No object generated: could not parse the response.",cause:o.error,text:n,response:r.response,usage:r.usage});const s=Q({value:o.value,schema:a});if(!s.success)throw new E({message:"No object generated: response did not match schema.",cause:s.error,text:n,response:r.response,usage:r.usage});return s.value}}};function G(t,a){const n=t.getReader(),r=a.getReader();let o,s,p=!1,m=!1;async function g(i){try{o==null&&(o=n.read());const l=await o;o=void 0,l.done?i.close():i.enqueue(l.value)}catch(l){i.error(l)}}async function v(i){try{s==null&&(s=r.read());const l=await s;s=void 0,l.done?i.close():i.enqueue(l.value)}catch(l){i.error(l)}}return new ReadableStream({async pull(i){try{if(p){await v(i);return}if(m){await g(i);return}o==null&&(o=n.read()),s==null&&(s=r.read());const{result:l,reader:S}=await Promise.race([o.then(f=>({result:f,reader:n})),s.then(f=>({result:f,reader:r}))]);l.done||i.enqueue(l.value),S===n?(o=void 0,l.done&&(await v(i),p=!0)):(s=void 0,l.done&&(m=!0,await g(i)))}catch(l){i.error(l)}},cancel(){n.cancel(),r.cancel()}})}h({prefix:"aitxt",size:24});h({prefix:"msg",size:24});var De={};j(De,{mergeIntoDataStream:()=>Ee,toDataStream:()=>Oe,toDataStreamResponse:()=>Ce});function $(t={}){const a=new TextEncoder;let n="";return new TransformStream({async start(){t.onStart&&await t.onStart()},async transform(r,o){o.enqueue(a.encode(r)),n+=r,t.onToken&&await t.onToken(r),t.onText&&typeof r=="string"&&await t.onText(r)},async flush(){t.onCompletion&&await t.onCompletion(n),t.onFinal&&await t.onFinal(n)}})}function b(t,a){return t.pipeThrough(new TransformStream({transform:async(n,r)=>{var o;if(typeof n=="string"){r.enqueue(n);return}if("event"in n){n.event==="on_chat_model_stream"&&M((o=n.data)==null?void 0:o.chunk,r);return}M(n,r)}})).pipeThrough($(a)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(n,r)=>{r.enqueue(P("text",n))}}))}function Oe(t,a){return b(t,a).pipeThrough(new TextEncoderStream)}function Ce(t,a){var n;const r=b(t,a?.callbacks).pipeThrough(new TextEncoderStream),o=a?.data,s=a?.init,p=o?G(o.stream,r):r;return new Response(p,{status:(n=s?.status)!=null?n:200,statusText:s?.statusText,headers:F(s?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Ee(t,a){a.dataStream.merge(b(t,a.callbacks))}function M(t,a){if(typeof t.content=="string")a.enqueue(t.content);else{const n=t.content;for(const r of n)r.type==="text"&&a.enqueue(r.text)}}var Me={};j(Me,{mergeIntoDataStream:()=>Ne,toDataStream:()=>Pe,toDataStreamResponse:()=>Ae});function _(t,a){const n=Fe();return Z(t[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(r,o){o.enqueue(n(r.delta))}})).pipeThrough($(a)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,o)=>{o.enqueue(P("text",r))}}))}function Pe(t,a){return _(t,a).pipeThrough(new TextEncoderStream)}function Ae(t,a={}){var n;const{init:r,data:o,callbacks:s}=a,p=_(t,s).pipeThrough(new TextEncoderStream),m=o?G(o.stream,p):p;return new Response(m,{status:(n=r?.status)!=null?n:200,statusText:r?.statusText,headers:F(r?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Ne(t,a){a.dataStream.merge(_(t,a.callbacks))}function Fe(){let t=!0;return a=>(t&&(a=a.trimStart(),a&&(t=!1)),a)}const ke=["node_modules/**",".git/**",".github/**",".vscode/**","**/*.jpg","**/*.jpeg","**/*.png","dist/**","build/**",".next/**","coverage/**",".cache/**",".vscode/**",".idea/**","**/*.log","**/.DS_Store","**/npm-debug.log*","**/yarn-debug.log*","**/yarn-error.log*","**/*lock.json","**/*lock.yaml"];function Ue(){const[t]=X(),{ready:a,importChat:n}=ee(),{ready:r,gitClone:o}=te(),[s,p]=w.useState(!1),[m,g]=w.useState(!0),v=async i=>{if(!(!r&&!a)&&i){const l=ne().add(ke);try{const{workdir:S,data:f}=await o(i);if(n){const J=Object.keys(f).filter(d=>!l.ignores(d)),H=new TextDecoder("utf-8"),R=J.map(d=>{const{data:y,encoding:V}=f[d];return{path:d,content:V==="utf8"?y:y instanceof Uint8Array?H.decode(y):""}}).filter(d=>d.content),L=await oe(R),I=se(L),x=[{role:"assistant",content:`Cloning the repo ${i} into ${S}
<boltArtifact id="imported-files" title="Git Cloned Files"  type="bundled">
${R.map(d=>`<boltAction type="file" filePath="${d.path}">
${ie(d.content)}
</boltAction>`).join(`
`)}
</boltArtifact>`,id:C(),createdAt:new Date}];I&&(x.push({role:"user",id:C(),content:"Setup the codebase and Start the application"}),x.push(I)),await n(`Git Project:${i.split("/").slice(-1)[0]}`,x,{gitUrl:i})}}catch(S){console.error("Error during import:",S),O.error("Failed to import repository"),g(!1),window.location.href="/";return}}};return w.useEffect(()=>{if(!a||!r||s)return;const i=t.get("url");if(!i){window.location.href="/";return}v(i).catch(l=>{console.error("Error importing repo:",l),O.error("Failed to import repository"),g(!1),window.location.href="/"}),p(!0)},[t,a,r,s]),u.jsx(A,{fallback:u.jsx(N,{}),children:()=>u.jsxs(u.Fragment,{children:[u.jsx(ae,{}),m&&u.jsx(re,{message:"Please wait while we clone the repository..."})]})})}const $e=()=>[{title:"Bolt"},{name:"description",content:"Talk with Bolt, an AI assistant from StackBlitz"}];function Je(){return u.jsxs("div",{className:"flex flex-col h-full w-full bg-bolt-elements-background-depth-1",children:[u.jsx(le,{}),u.jsx(ce,{}),u.jsx(A,{fallback:u.jsx(N,{}),children:()=>u.jsx(Ue,{})})]})}export{Je as default,$e as meta};
