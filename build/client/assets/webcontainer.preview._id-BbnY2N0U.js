import{r as a,j as c}from"./index-5yin8JJm.js";import{u as f}from"./components-Bwa7pH9e.js";const p="preview-updates";function m(){const{previewId:s}=f(),e=a.useRef(null),t=a.useRef(),[r,u]=a.useState(""),l=a.useCallback(()=>{e.current&&r&&(e.current.src="",requestAnimationFrame(()=>{e.current&&(e.current.src=r)}))},[r]),o=a.useCallback(()=>{t.current&&r&&t.current.postMessage({type:"preview-ready",previewId:s,url:r,timestamp:Date.now()})},[s,r]);return a.useEffect(()=>{t.current=new BroadcastChannel(p),t.current.onmessage=n=>{n.data.previewId===s&&(n.data.type==="refresh-preview"||n.data.type==="file-change")&&l()};const i=`https://${s}.local-credentialless.webcontainer-api.io`;return u(i),e.current&&(e.current.src=i),o(),()=>{t.current?.close()}},[s,l,o]),c.jsx("div",{className:"w-full h-full",children:c.jsx("iframe",{ref:e,title:"WebContainer Preview",className:"w-full h-full border-none",sandbox:"allow-scripts allow-forms allow-popups allow-modals allow-storage-access-by-user-activation allow-same-origin",allow:"cross-origin-isolated",loading:"eager",onLoad:o})})}export{m as default};
